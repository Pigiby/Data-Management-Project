#FOR EACH ROUTE RETURN THE AIRCRAFT THAT HAD THE LEAST CO2_EMISSION

select distinct from_airport_code, dest_airport_code, aircraft_type, co2_emissions
from flights_data
where co2_emissions <= all (select f.co2_emissions
					  from flights_data f
					  where flights_data.from_airport_code = f.from_airport_code
					  		and flights_data.dest_airport_code = f.dest_airport_code
					  		)
order by from_airport_code, dest_airport_code




#FOR EACH AIRLINE COMPUTE THE AVERAGE CO2 EMISSION PER MINUTE

select distinct airline_name, sum(co2_emissions) / sum(duration)
from flights_data
group by airline_name


#FOR EACH AIRLINE RETURN ALL THE ROUTES
create view routes_per_airline(select distinct from_airport_code, dest_airport_code,airline
from flights_data, fleet_data
where airline_name = airline
order by airline)


# FOR EACH AIRLINE RETURN THE MONTH WITH THE HIGHEST AVERAGE CO2_EMISSION PER MINUTE

create view monthly_avg as (select distinct airline_name, departure_month, sum(co2_emissions)/sum(duration) as monthly
from flights_data
group by airline_name, departure_month
order by airline_name, departure_month) 

select airline_name, departure_month, monthly
from monthly_avg
where monthly <= ALL (select monthly 
					  from monthly_avg m
					  where m.airline_name = monthly_avg.airline_name)




#FOR EACH AIRLINE AND EACH MONTH RETURN THE NUMBER OF FLIGHTS 
select airline_name, departure_month, count(*)
from flights_data
group by airline_name, departure_month
order by airline_name, departure_month





#FOR EACH ROUTE RETURN THE AIRLINE WITH THE HIGHEST CO2_PERCENTAGE EMISSION wrt THE_AVG_EMISSION_FOR_THIS_ROUTE

select DISTINCT from_airport_code, dest_airport_code, airline_name, co2_percentage
from flights_data
where co2_percentage >= ALL (select co2_percentage
							from flights_data f
							where f.from_airport_code = flights_data.from_airport_code
							 	  and f.dest_airport_code = flights_data.dest_airport_code
							)



#FOR EACH AIRPORT COUNT THE INCOMING/OUTGOING FLIGHTS
select iata_code,count(*)
from airports_data,flights_data
where iata_code = from_airport_code or iata_code = dest_airport_code
group by iata_code
order by iata_code



#FOR EACH AIRLINE RETURN THE TOTAL NUMBER OF CURRENT AIRCRAFTS
select airline,sum(current)
from fleet_data
group by airline
order by airline


#FOR EACH AIRCRAFT TYPE RETURN HOW MANY OF THEM ARE IN CIRCULATION CURRENTLY (SORTED)
select aircraft_type,sum(current)
from fleet_data
group by aircraft_type
ORDER BY sum(current) DESC


#FOR EACH AIRLINE RETURN HOW MANY DIFFERENT AICRAFT TYPES IT OWNS
select aircraft_type,sum(current)
from fleet_data
group by aircraft_type
ORDER BY sum(current) DESC



#FOR EACH ROUTE RETURN THE LESS POLLUTING AIRCRAFT

create view less_polluting_aircraft as (
select distinct from_airport_code, dest_airport_code, aircraft_type, co2_emissions
from flights_data
where co2_emissions <= all (select f.co2_emissions
            from flights_data f
            where flights_data.from_airport_code = f.from_airport_code
                and flights_data.dest_airport_code = f.dest_airport_code
                )
order by from_airport_code, dest_airport_code)


#FOR EACH AIRLINE RETURN THE ROUTES IT DOES
create view routes_per_airline as(select distinct from_airport_code, dest_airport_code,airline
from flights_data, fleet_data
where airline_name = airline
order by airline)

#FOR EACH ROUTE DONE BY AN AIRLINE SEE HOW MANY OF THE LEAST POLLUTING AIRCRAFT OF THIS ROUTE THE AIRLINE OWNS CURRENTLY OR WILL OWN
create view airlines_investments as(
select distinct al.airline, al.base_country, ac.aircraft_type, c.current + f.future as investment
from routes_per_airline, less_polluting_aircraft, current c, future f, airline al, aircraft ac
where routes_per_airline.departure = less_polluting_aircraft.departure and
	  routes_per_airline.arrival = less_polluting_aircraft.arrival and
	  al.airline = routes_per_airline.airline and 
	  al.airline_key = c.airline_key and al.airline_key = f.airline_key and 
	  ac.aircraft_key = c.aircraft_key and ac.aircraft_key = f.aircraft_key and
	  ac.aircraft_type = less_polluting_aircraft.aircraft_type
order by investment desc)


