#CREATE TABLES FOR CLEANED CSV FILES 

CREATE TABLE flight_data (
    from_airport_code varchar(255),
    from_country varchar(255),
    dest_airport_code varchar(255),
    dest_country varchar(255),
    aircraft_type varchar(255),
    airline_number varchar(255),
    airline_name varchar(255),
    flight_number varchar(255),
    departure_day int,
    departure_month int,
    departure_year int,
    departure_time time,
    arrival_day int,
    arrival_month int,
    arrival_year int,
    arrival_time time,
    duration int,
    price float,
    CO2_emissions int,
    AVG_CO2_emissions_for_this_route int,
    CO2_percentage int
);


 create table fleet_data(
  Parent_airline varchar(255),
  Airline varchar(255),
  Aircraft_Type varchar(255),
  Current int,
  Future int,
  Historic int,
  Total int,
  Unit_cost_$ float,
  Total_cost_$ float,
  Average_age float
)


create table airports_data(
	name varchar(255),
	city varchar(255),
	country varchar(255),
	iata_code varchar(255),
	icao_code varchar(255),
	latitude float,
	longitude float,
	altitude float,
	timezone float,
	tz varchar(255)
)

create table airlines_data(
	name varchar(255),
	iata_code varchar(255),
	icao_code varchar(255),
	country varchar(255)
)


create table airplanes_data(
	name varchar(255),
  iata_code varchar(255),
  icao_code varchar(255)
)




LOADING SNOWFLAKE SCHEMA into DB
create table DATE(
	date_key serial PRIMARY KEY,
	day int,
	month int,
	year int,
	time time
)

insert into date(day,month,year,time)
(select distinct departure_day,departure_month,departure_year,departure_time 
 from flight_data
 union 
 select distinct arrival_day,arrival_month,arrival_year,arrival_time 
 from flight_data)




create table airport(
	airport_key serial PRIMARY KEY,
	airport varchar(255),
	city varchar(255),
	country varchar(255),
	iata_code varchar(255),
	icao_code varchar(255),
	latitude float,
	longitude float,
	altitude float,
	timezone float,
	tz varchar(255)
)

insert into airport(airport, city, country, iata_code, icao_code, latitude, longitude, altitude, timezone, tz)
select * from airports_data





create table airline(
	airline_key serial PRIMARY KEY,
	airline varchar(255),
	iata_code varchar(255),
	icao_code varchar(255),
	base_country varchar(255)
)

insert into airline (airline, iata_code, icao_code, base_country)
select * from airlines_data



create table aircraft(
	aircraft_key serial PRIMARY KEY,
	aircraft_type varchar(255),
	iata_code varchar(255),
	icao_code varchar(255),
	airline int NOT NULL references airline(airline_key),
	current int,
	future int,
	historic int,
	avg_age float,
	unit_cost_$ float
)


insert into aircraft (aircraft_type, iata_code, icao_code, airline, current, future, historic, avg_age, unit_cost_$)
select aircraft_type, airplanes_data.iata_code, airplanes_data.icao_code, airline_key, fleet_data.Current, fleet_data.Future, fleet_data.Historic, fleet_data.Average_age, fleet_data.Unit_cost_$
from airplanes_data, airline, fleet_data
where fleet_data.aircraft_type = airplanes_data.name and airline.airline = fleet_data.airline

create table flight_number(
	flight_number_key serial,
	flight_number varchar(255),
	airline int NOT NULL references airline(airline_key),
	airport_src int NOT NULL references airport(airport_key),
	airport_dest int NOT NULL references airport(airport_key)
)

insert into flight_number(flight_number,airline,airport_src,airport_dest)
select distinct flight_data.flight_number, airline.airline_key,a1.airport_key,a2.airport_key
from flight_data,airline,airport a1, airport a2
where flight_data.airline_number = airline.iata_code and flight_data.from_airport_code = a1.iata_code and flight_data.dest_airport_code = a2.iata_code


create table flight(
	departure_date int references DATE(date_key),
	arrival_date int references DATE(date_key),
	departure_airport int references airport(airport_key),
	arrival_airport int references airport(airport_key),
	flight_number int references flight_number(flight_number_key),
	aircraft int references aircraft(aircraft_key),
	duration int,
	price float,
	CO2_emissions int,
	AVG_CO2_emissions_for_this_route int,
	CO2_percentage int,
	PRIMARY KEY (departure_date, arrival_date,departure_airport,arrival_airport,flight_number,aircraft)
)
insert into flight
select distinct d1.date_key,d2.date_key, a1.airport_key,a2.airport_key,fn.flight_number_key,c.aircraft_key, f.duration, f.price,f.co2_emissions,f.AVG_CO2_emissions_for_this_route,f.CO2_percentage 
from date d1, date d2,airport a1, airport a2,flight_number fn , flight_data f,aircraft c,airline al
where (d1.day = f.departure_day and d1.month = f.departure_month and d1.year = f.departure_year and d1.time = f.departure_time) and
	(d2.day = f.arrival_day and d2.month = f.arrival_month and d2.year = f.arrival_year and d2.time = f.arrival_time) and
	(f.flight_number = fn.flight_number and fn.airport_src = a1.airport_key and fn.airport_dest = a2.airport_key)and 
	c.aircraft_type = f.aircraft_type
	
	
	
select * from flight_data where departure_day = 2 and departure_month = 5 and dest_airport_code = 'FRA' and from_airport_code = 'BRU'

select * from date where date_key = 2877

select * from airport where airport_key = 300 or airport_key = 337

select * from flight_number where flight_number_key = 1302



